# Generated by re2c
# re2py $INPUT -o $OUTPUT

from enum import Enum
import os

BUFSIZE = 4096

class State:
    def __init__(self, fname):
        self.file = open(fname, "rb")
        self.str = bytearray(BUFSIZE)
        self.lim = BUFSIZE - 1 # exclude terminating null
        self.cur = self.lim
        self.mar = self.lim
        self.tok = self.lim
        self.eof = False

    def __del__(self):
        self.file.close()

class Status(Enum):
    OK = 0
    EOF = 1
    LONG_LEXEME = 2

def fill(st):
    if st.eof:
        return Status.EOF

    # Error: lexeme too long. In real life could reallocate a larger buffer.
    if st.tok < 1:
        return Status.LONG_LEXEME

    # Shift buffer contents (discard everything up to the current token).
    st.str = st.str[st.tok:st.lim]
    st.cur -= st.tok;
    st.mar -= st.tok;
    st.lim -= st.tok;
    st.tok = 0;

    # Fill free space at the end of buffer with new data from file.
    bytes = st.file.read(BUFSIZE - st.lim - 1) # -1 for sentinel
    if not bytes:
        st.eof = True # end of file
    else:
        st.lim += len(bytes);
        st.str += bytes

    st.str += b'\0' # append sentinel

    return Status.OK

def lex(yyrecord, count):
    while True:
        yyrecord.tok = yyrecord.cur
        
        yystate = 0
        while True:
            match yystate:
                case 0:
                    yych = yyrecord.str[yyrecord.cur]
                    if yych <= 0x20:
                        if yych <= 0x00:
                            if yyrecord.lim <= yyrecord.cur:
                                if fill(yyrecord) == Status.OK:
                                    yystate = 0
                                    continue
                                yystate = 9
                                continue
                            yyrecord.cur += 1
                            yystate = 1
                            continue
                        if yych >= 0x20:
                            yyrecord.cur += 1
                            yystate = 3
                            continue
                        yyrecord.cur += 1
                        yystate = 1
                        continue
                    else:
                        if yych == 0x27:
                            yyrecord.cur += 1
                            yystate = 5
                            continue
                        yyrecord.cur += 1
                        yystate = 1
                        continue
                case 1:
                    yystate = 2
                    continue
                case 2:
                    return -1
                case 3:
                    yych = yyrecord.str[yyrecord.cur]
                    if yych <= 0x00:
                        if yyrecord.lim <= yyrecord.cur:
                            if fill(yyrecord) == Status.OK:
                                yystate = 3
                                continue
                        yystate = 4
                        continue
                    if yych == 0x20:
                        yyrecord.cur += 1
                        yystate = 3
                        continue
                    yystate = 4
                    continue
                case 4:
                    break
                case 5:
                    yyrecord.mar = yyrecord.cur
                    yych = yyrecord.str[yyrecord.cur]
                    if yych >= 0x01:
                        yystate = 7
                        continue
                    if yyrecord.lim <= yyrecord.cur:
                        if fill(yyrecord) == Status.OK:
                            yystate = 5
                            continue
                        yystate = 2
                        continue
                    yyrecord.cur += 1
                    yystate = 6
                    continue
                case 6:
                    yych = yyrecord.str[yyrecord.cur]
                    yystate = 7
                    continue
                case 7:
                    if yych <= 0x27:
                        if yych <= 0x00:
                            if yyrecord.lim <= yyrecord.cur:
                                if fill(yyrecord) == Status.OK:
                                    yystate = 6
                                    continue
                                yystate = 10
                                continue
                            yyrecord.cur += 1
                            yystate = 6
                            continue
                        if yych <= 0x26:
                            yyrecord.cur += 1
                            yystate = 6
                            continue
                        yyrecord.cur += 1
                    else:
                        if yych == 0x5C:
                            yyrecord.cur += 1
                            yystate = 8
                            continue
                        yyrecord.cur += 1
                        yystate = 6
                        continue
                    count += 1
                    break
                case 8:
                    yych = yyrecord.str[yyrecord.cur]
                    if yych <= 0x00:
                        if yyrecord.lim <= yyrecord.cur:
                            if fill(yyrecord) == Status.OK:
                                yystate = 8
                                continue
                            yystate = 10
                            continue
                        yyrecord.cur += 1
                        yystate = 6
                        continue
                    yyrecord.cur += 1
                    yystate = 6
                    continue
                case 9:
                    return count
                case 10:
                    yyrecord.cur = yyrecord.mar
                    yystate = 2
                    continue
                case _:
                    raise "internal lexer error"


def main():
    fname = "input"

    # Prepare input file.
    f = open(fname, "w")
    for i in range(BUFSIZE):
        f.write("'qu\0tes' 'are' 'fine: \\'' ")
    f.close()

    # Run lexer on the prepared file.
    st = State(fname)
    assert lex(st, 0) == 3 * BUFSIZE

    # Cleanup.
    os.remove(fname)

if __name__ == '__main__':
    main()
